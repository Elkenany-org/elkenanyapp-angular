{"ast":null,"code":"import { Banner_test, logo_test } from '@app/modules/home/data';\nimport { map } from 'rxjs';\nimport { co_Search_Form_Data } from '@app/@core/interfaces/companies-guid/co-companies';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../@core/services/modules/companies-guide/companies-guide.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@app/@core/services/Banners-logos.service\";\nimport * as i5 from \"@angular/platform-browser\";\nimport * as i6 from \"../../../../@shared/components/app/banner-logos/banner-logos.component\";\nimport * as i7 from \"../../../../@shared/components/app/horizontal-search/horizontal-search.component\";\nimport * as i8 from \"../../../../@shared/components/app/card/card.component\";\nimport * as i9 from \"ngx-pagination\";\nimport * as i10 from \"../../../../@shared/components/loader/loader.component\";\n\nfunction CoGuideComponent_app_loader_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\n\nfunction CoGuideComponent_span_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", 12 * (ctx_r1.page.last_page - 1) + ctx_r1.comLength, \" \\u0634\\u0631\\u0643\\u0629\");\n  }\n}\n\nfunction CoGuideComponent_span_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.Companies == null ? null : ctx_r2.Companies.data == null ? null : ctx_r2.Companies.data.length, \" \\u0634\\u0631\\u0643\\u0629\");\n  }\n}\n\nfunction CoGuideComponent_li_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"li\");\n  }\n}\n\nconst _c0 = function () {\n  return [];\n};\n\nconst _c1 = function (a1) {\n  return {\n    itemsPerPage: 1,\n    currentPage: a1\n  };\n};\n\nexport let CoGuideComponent = /*#__PURE__*/(() => {\n  class CoGuideComponent {\n    constructor(companiesGuideService, route, router, activatedRoute, location, BannerLogoService, titleService) {\n      this.companiesGuideService = companiesGuideService;\n      this.route = route;\n      this.router = router;\n      this.activatedRoute = activatedRoute;\n      this.location = location;\n      this.BannerLogoService = BannerLogoService;\n      this.titleService = titleService;\n      this.flagFirsttime = false;\n      this.loading = false;\n      this.carousel_banner = Banner_test;\n      this.carousel_logos = logo_test;\n      this.page = {\n        last_page: 0,\n        current_page: 0\n      };\n      this.sub = {\n        current_sub: 1\n      };\n      this.Sector = {\n        poultry: 1,\n        animal: 2,\n        farm: 3,\n        fish: 4,\n        horses: 5,\n        industrial: 6\n      };\n      this.filterData = {\n        section_id: \"\",\n        sub_id: \"\",\n        sort: \"2\",\n        country_id: \"\",\n        city_id: \"\",\n        search: \"\",\n        page: ''\n      };\n      this.comLength = 0;\n\n      this.onBackButtonEvent = event => {\n        const page = this.getPageNumberFromUrl();\n        const sub = this.getSubIdFromUrl();\n\n        if (page !== this.page.current_page || sub !== +this.filterData[\"sub_id\"]) {\n          this.page.current_page = page;\n          this.filterData[\"page\"] = page + '';\n          this.filterData[\"sub_id\"] = sub + '';\n          this.companiesGuideService.Companiesv2(this.filterData).subscribe(res => {\n            var _a, _b;\n\n            this.page.current_page = (_a = res.data) === null || _a === void 0 ? void 0 : _a.current_page;\n            this.page.last_page = (_b = res.data) === null || _b === void 0 ? void 0 : _b.last_page;\n            this.Companies = res.data;\n\n            if (page > 1) {\n              this.Companies.compsort = [];\n            }\n\n            this.setSelectedSubSection(sub);\n            this.typeAr = this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id === sub).name;\n            this.titleService.setTitle(' قسم ' + this.typeAr);\n            window.scroll(0, 0);\n          });\n        }\n      };\n    }\n\n    ngOnInit() {\n      this.h_search_form = co_Search_Form_Data; //set initial data to horizontal component \n\n      this.activatedRoute.data.pipe(map(data => {\n        return data;\n      })).subscribe(res => {\n        this.page.current_page = res['resolve'].data.current_page;\n        this.page.last_page = res['resolve'].data.last_page;\n        this.Companies = res['resolve'].data;\n        this.BannerLogoService.setBanner(res['resolve'].data.banners);\n        this.BannerLogoService.setLogo(res['resolve'].data.logos);\n        this.loading = false;\n        this.flagFirsttime = true;\n        this.h_search_form.title = ' شركات الدليل ';\n        this.titleService.setTitle(' شركات الدليل ');\n      });\n      this.activatedRoute.queryParamMap.subscribe(params => {\n        this.id = params.get('sub') || '';\n      });\n      this.route.params.subscribe(params => {\n        this.type = params['type']; // this.sub.current_sub=params['id']\n\n        this.companiesGuideService.co_Filter_listV2(params['type'], '').subscribe(res => {\n          var _a, _b, _c, _d, _e, _f, _g;\n\n          this.typeAr = (_b = (_a = res.data) === null || _a === void 0 ? void 0 : _a.sub_sections.find(i => i.id == this.id)) === null || _b === void 0 ? void 0 : _b.name;\n          this.titleService.setTitle(' قسم ' + this.typeAr); //override data to match the data format of horizontal components\n\n          this.h_search_form.controls.find(i => i.role === \"sector\").option = (_c = res.data) === null || _c === void 0 ? void 0 : _c.sectors;\n          this.h_search_form.controls.find(i => i.role === \"subsection\").option = (_d = res.data) === null || _d === void 0 ? void 0 : _d.sub_sections;\n          this.h_search_form.controls.find(i => i.role === \"cities\").option = (_e = res.data) === null || _e === void 0 ? void 0 : _e.cities;\n          this.h_search_form.controls.find(i => i.role === \"countries\").option = (_f = res.data) === null || _f === void 0 ? void 0 : _f.countries;\n          this.h_search_form.controls.find(i => i.role === \"sort\").option = (_g = res.data) === null || _g === void 0 ? void 0 : _g.sort;\n          this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id == this.id).selected = 1;\n          this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id != this.id).selected = 0;\n          this.filterData[\"section_id\"] = params['type'];\n          this.filterData[\"sub_id\"] = this.id + '';\n          this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === 2).selected = 1;\n          this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id !== 2).selected = 0;\n        });\n      });\n\n      if (this.page.last_page > 1) {\n        this.companiesGuideService.Companiesv2({\n          section_id: this.filterData[\"section_id\"],\n          sub_id: this.id,\n          sort: \"\",\n          country_id: \"\",\n          city_id: \"\",\n          search: \"\",\n          page: this.page.last_page + ''\n        }).subscribe(res => {\n          var _a; // this.comLength = res.data?.data.length!\n\n\n          this.comLength = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data.length;\n        });\n      }\n\n      window.addEventListener('popstate', this.onBackButtonEvent);\n    }\n\n    ngOnDestroy() {\n      window.removeEventListener('popstate', this.onBackButtonEvent);\n    }\n\n    filter(option) {\n      let sectorId;\n      let sectorType;\n      let sort = '2';\n      this.filterData[\"page\"] = '1';\n      this.route.params.subscribe(params => {\n        if (!this.filterData[\"section_id\"]) {\n          this.filterData[\"section_id\"] = params['type'];\n        }\n\n        if (!this.filterData[\"sub_id\"]) {\n          this.filterData[\"sub_id\"] = params['id'];\n        } // \n        // console.log(this.filterData);\n\n\n        switch (option.type) {\n          case \"subsection\":\n            this.filterData[\"sub_id\"] = option.id;\n            this.location.go(`/companies-guide/${this.type}/companies/${this.type}`, `page=${this.filterData['page']}&sub=${this.filterData[\"sub_id\"]}`);\n            this.setSelectedSubSection(option.id);\n            this.typeAr = this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id === option.id).name;\n            this.titleService.setTitle(' قسم ' + this.typeAr);\n            break;\n\n          case \"sector\":\n            this.filterData[\"section_id\"] = option.id;\n            this.router.navigate([`companies-guide/${option.id}`]);\n            break;\n\n          case \"sort\":\n            this.filterData[\"sort\"] = option.id;\n            this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === option.id).selected = 1;\n            this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id !== option.id).selected = 0;\n            sort = this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === option.id).value; // console.log(option.id);\n\n            if (option.id == '1') {\n              sort = '0';\n            } else if (option.id == '2') {\n              sort = '2';\n            }\n\n            this.filterData[\"sort\"] = sort;\n            break;\n\n          case \"countries\":\n            this.filterData[\"country_id\"] = option.id;\n            break;\n\n          case \"cities\":\n            this.filterData[\"city_id\"] = option.id;\n            break;\n\n          case \"search\":\n            this.filterData[\"search\"] = option.name;\n            break;\n\n          default:\n            // \n            break;\n        }\n\n        if (option.type == 'countries') {\n          this.companiesGuideService.co_Filter_listV2(this.filterData[\"section_id\"], this.filterData[\"country_id\"]).subscribe(res => {\n            //override data to match the data format of horizontal components\n            var _a, _b, _c, _d, _e;\n\n            this.h_search_form.controls.find(i => i.role === \"sector\").option = (_a = res.data) === null || _a === void 0 ? void 0 : _a.sectors;\n            this.h_search_form.controls.find(i => i.role === \"cities\").option = (_b = res.data) === null || _b === void 0 ? void 0 : _b.cities;\n            this.h_search_form.controls.find(i => i.role === \"countries\").option = (_c = res.data) === null || _c === void 0 ? void 0 : _c.countries;\n            this.h_search_form.controls.find(i => i.role === \"sort\").option = (_d = res.data) === null || _d === void 0 ? void 0 : _d.sort;\n            this.h_search_form.controls.find(i => i.role === \"subsection\").option = (_e = res.data) === null || _e === void 0 ? void 0 : _e.sub_sections;\n          });\n        } // }\n\n\n        if (option.type != 'sector') {\n          this.companiesGuideService.Companiesv2(this.filterData).subscribe(res => {\n            var _a, _b, _c, _d; // this.typeAr= option.title\n\n\n            this.page.current_page = (_a = res.data) === null || _a === void 0 ? void 0 : _a.current_page;\n            this.page.last_page = (_b = res.data) === null || _b === void 0 ? void 0 : _b.last_page;\n            this.Companies = res.data;\n\n            if (option.type == \"search\" && this.filterData[\"search\"] != \"\" || option.type == \"countries\" || option.type == \"cities\") {\n              this.Companies.compsort = [];\n            }\n\n            this.BannerLogoService.setBanner((_c = res.data) === null || _c === void 0 ? void 0 : _c.banners);\n            this.BannerLogoService.setLogo((_d = res.data) === null || _d === void 0 ? void 0 : _d.logos);\n            this.loading = false;\n\n            if (this.page.last_page > 1) {\n              this.companiesGuideService.Companiesv2({\n                section_id: this.filterData[\"section_id\"],\n                sub_id: this.filterData[\"sub_id\"],\n                sort: this.filterData[\"sort\"],\n                country_id: this.filterData[\"country_id\"],\n                city_id: this.filterData[\"city_id\"],\n                search: this.filterData[\"search\"],\n                page: this.page.last_page + ''\n              }).subscribe(res => {\n                var _a;\n\n                this.comLength = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data.length;\n              });\n            }\n          });\n        }\n      });\n    }\n\n    navigate(id) {\n      this.router.navigate([`companies-guide/${this.type}/companies_details/${this.type}/${id}`]);\n    }\n\n    rate(body) {\n      this.companiesGuideService.rate(body).subscribe(res => {});\n    }\n\n    next_page(page) {\n      this.filterData[\"page\"] = page + ''; // this.filterData[\"sub_id\"]= this.id +''\n\n      this.filterData[\"section_id\"] = this.type + '';\n      this.companiesGuideService.Companiesv2(this.filterData).subscribe(res => {\n        var _a, _b;\n\n        this.page.current_page = (_a = res.data) === null || _a === void 0 ? void 0 : _a.current_page;\n        this.page.last_page = (_b = res.data) === null || _b === void 0 ? void 0 : _b.last_page;\n        this.Companies = res.data;\n\n        if (page > 1) {\n          this.Companies.compsort = [];\n        }\n\n        window.scroll(0, 0);\n      });\n      this.location.go(`/companies-guide/${this.type}/companies/${this.type}`, `page=${page}&sub=${this.filterData[\"sub_id\"]}`);\n    }\n\n    getPageNumberFromUrl() {\n      const page = this.location.path().match(/page=(\\d+)/);\n      return page ? +page[1] : 1;\n    }\n\n    getSubIdFromUrl() {\n      const sub = this.location.path().match(/sub=(\\d+)/);\n      return sub ? +sub[1] : 1;\n    }\n\n    setSelectedSubSection(id) {\n      for (let option of this.h_search_form.controls.find(i => i.role === \"subsection\").option) {\n        option.selected = 0;\n      }\n\n      this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id === id).selected = 1;\n      this.h_search_form.controls.find(i => i.role === \"subsection\").option.find(i => i.id !== id).selected = 0;\n    }\n\n  }\n\n  CoGuideComponent.ɵfac = function CoGuideComponent_Factory(t) {\n    return new (t || CoGuideComponent)(i0.ɵɵdirectiveInject(i1.CompaniesGuideService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Location), i0.ɵɵdirectiveInject(i4.BannersLogoservice), i0.ɵɵdirectiveInject(i5.Title));\n  };\n\n  CoGuideComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CoGuideComponent,\n    selectors: [[\"app-co-guide\"]],\n    decls: 32,\n    vars: 26,\n    consts: [[4, \"ngIf\"], [1, \"main__content__body\"], [1, \"container\"], [1, \"mt-3\", \"mt-lg-0\"], [3, \"loading\", \"type\"], [1, \"banner__header\"], [1, \"container-fluid\", \"one-full-slider-banner\"], [\"id\", \"image-slider\", 1, \"splide\"], [1, \"splide__track\"], [1, \"partners\", \"slider\"], [1, \"container-fluid\", \"logos__holder\"], [\"dir\", \"rtl\", 1, \"partners-slider\"], [\"id\", \"partnerCarousel\", 1, \"splide\"], [3, \"data\", \"newItemEvent\"], [1, \"container\", \"global__container\"], [1, \"title-box\"], [1, \"title\"], [\"class\", \"sections-number\", 4, \"ngIf\"], [3, \"data\", \"flag\", \"subcard\", \"loading\", \"navigation\"], [1, \"row\", \"pagination__container\"], [1, \"col-12\"], [1, \"pagination\"], [4, \"ngFor\", \"ngForOf\"], [\"previousLabel\", \"\", \"nextLabel\", \"\", 3, \"maxSize\", \"click\", \"pageChange\"], [1, \"sections-number\"]],\n    template: function CoGuideComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, CoGuideComponent_app_loader_0_Template, 1, 0, \"app-loader\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"h1\", 3);\n        i0.ɵɵtext(4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(5, \"app-banners-logo\", 4);\n        i0.ɵɵelement(6, \"app-banners-logo\", 4);\n        i0.ɵɵelementStart(7, \"header\", 5);\n        i0.ɵɵelementStart(8, \"div\", 6);\n        i0.ɵɵelementStart(9, \"div\", 7);\n        i0.ɵɵelementStart(10, \"div\", 8);\n        i0.ɵɵelement(11, \"div\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"article\", 9);\n        i0.ɵɵelementStart(13, \"div\", 10);\n        i0.ɵɵelementStart(14, \"section\", 11);\n        i0.ɵɵelement(15, \"section\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"app-horizontal-search\", 13);\n        i0.ɵɵlistener(\"newItemEvent\", function CoGuideComponent_Template_app_horizontal_search_newItemEvent_16_listener($event) {\n          return ctx.filter($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"article\", 14);\n        i0.ɵɵelementStart(18, \"section\", 15);\n        i0.ɵɵelementStart(19, \"h2\", 16);\n        i0.ɵɵtext(20);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(21, CoGuideComponent_span_21_Template, 2, 1, \"span\", 17);\n        i0.ɵɵtemplate(22, CoGuideComponent_span_22_Template, 2, 1, \"span\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"app-card\", 18);\n        i0.ɵɵlistener(\"navigation\", function CoGuideComponent_Template_app_card_navigation_23_listener($event) {\n          return ctx.navigate($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"app-card\", 18);\n        i0.ɵɵlistener(\"navigation\", function CoGuideComponent_Template_app_card_navigation_24_listener($event) {\n          return ctx.navigate($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"div\", 19);\n        i0.ɵɵelementStart(26, \"div\", 20);\n        i0.ɵɵelementStart(27, \"div\", 21);\n        i0.ɵɵelementStart(28, \"ul\");\n        i0.ɵɵtemplate(29, CoGuideComponent_li_29_Template, 1, 0, \"li\", 22);\n        i0.ɵɵpipe(30, \"paginate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(31, \"pagination-controls\", 23);\n        i0.ɵɵlistener(\"click\", function CoGuideComponent_Template_pagination_controls_click_31_listener() {\n          return ctx.next_page(ctx.page.current_page);\n        })(\"pageChange\", function CoGuideComponent_Template_pagination_controls_pageChange_31_listener($event) {\n          return ctx.page.current_page = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.h_search_form.title);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"loading\", ctx.loading)(\"type\", \"banner\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"loading\", ctx.loading)(\"type\", \"logo\");\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"data\", ctx.h_search_form);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.typeAr);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.page.last_page > 1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.page.last_page == 1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"data\", ctx.Companies == null ? null : ctx.Companies.compsort)(\"flag\", true)(\"subcard\", true)(\"loading\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"data\", ctx.Companies == null ? null : ctx.Companies.data)(\"flag\", false)(\"subcard\", true)(\"loading\", ctx.loading);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind2(30, 20, i0.ɵɵpureFunction0(23, _c0).constructor(ctx.page.last_page), i0.ɵɵpureFunction1(24, _c1, ctx.page.current_page)));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"maxSize\", 7);\n      }\n    },\n    directives: [i3.NgIf, i6.BannerLogosComponent, i7.HorizontalSearchComponent, i8.CardComponent, i3.NgForOf, i9.PaginationControlsComponent, i10.LoaderComponent],\n    pipes: [i9.PaginatePipe],\n    styles: [\".current{background:#FFBB33!important}.pagination{margin:15px 200px 0 50px}@media screen and (max-width: 600px){.pagination{margin:15px 50px 0}}\\n\"],\n    encapsulation: 2\n  });\n  return CoGuideComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}