{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/@core/services/modules/market/market.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@app/@core/services/toastr.service\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/platform-browser\";\nimport * as i6 from \"@angular/common/http\";\nimport * as i7 from \"@app/@core/services/auth/auth.service\";\nimport * as i8 from \"@angular/common\";\n\nfunction AddAdComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵelement(1, \"img\", 31);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const file_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", file_r3.fileResult, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction AddAdComponent_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function AddAdComponent_button_12_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.deleteImages();\n    });\n    i0.ɵɵtext(1, \" \\u062D\\u062F\\u0641 \\u0627\\u0644\\u0635\\u0648\\u0631 \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let AddAdComponent = /*#__PURE__*/(() => {\n  class AddAdComponent {\n    constructor(market, router, toasterService, route, fb, titleService, http, auth) {\n      this.market = market;\n      this.router = router;\n      this.toasterService = toasterService;\n      this.route = route;\n      this.fb = fb;\n      this.titleService = titleService;\n      this.http = http;\n      this.auth = auth;\n      this.pageName = \"إضافة إعلان\";\n      this.AllFiles = [];\n      this.currentImage = []; //it is come from edit api\n\n      this.new_Image = []; // it is for new image that may be  will add for edite api\n\n      this.id = '';\n      this.url = [];\n      this.deviceToken = '';\n    }\n\n    ngOnInit() {\n      this.titleService.setTitle(this.pageName);\n      this.url = this.router.url.split('/');\n      let secId = this.url[this.url.length - 3] || 0; // console.log(  this.url)\n\n      this.AdForm({}, secId);\n      this.route.params.subscribe(param => {\n        this.id = param['id'];\n\n        if (this.id !== '0') {\n          // if it = 0 its mean user want to add ad if > 0 means user wants to edite\n          this.pageName = \"تعديل إعلان\";\n          this.market.get_ad(this.id).subscribe(res => {\n            var _a, _b, _c; // console.log(res)\n\n\n            (_a = res.data) === null || _a === void 0 ? void 0 : _a.ad_detials.images.forEach(i => this.AllFiles.push({\n              name: '',\n              file: {},\n              fileResult: i.image\n            }));\n            (_b = res.data) === null || _b === void 0 ? void 0 : _b.ad_detials.images.forEach(i => this.currentImage.push({\n              name: '',\n              file: {},\n              fileResult: i.image\n            })); // this.AllFiles = res.data?.ad_detials.images as any\n            // console.log( this.AllFiles)\n\n            this.AdForm((_c = res.data) === null || _c === void 0 ? void 0 : _c.ad_detials, secId);\n          });\n        }\n      });\n      this.auth.requestPermission();\n      this.auth.deviceToken.subscribe(item => {\n        this.deviceToken = item;\n      });\n    }\n\n    handleFileInput(event) {\n      const fileList = event.target.files;\n\n      if (fileList.length > 0) {\n        for (const file of fileList) {\n          // console.log(file);\n          const reader = new FileReader();\n          reader.readAsDataURL(file);\n\n          reader.onload = e => {\n            this.toasterService.loading('جارى رفع الملفات...');\n            this.new_Image.push({\n              fileResult: reader.result,\n              file,\n              name: file.name\n            });\n            this.AllFiles.push({\n              fileResult: reader.result,\n              file,\n              name: file.name\n            });\n          };\n\n          reader.onloadend = ee => {\n            this.toasterService.stopLoading();\n          };\n        }\n      }\n    }\n\n    removeImage(name) {\n      this.AllFiles = this.AllFiles.filter(image => {\n        return image.name !== name;\n      });\n    }\n\n    onSubmit() {\n      const formData = new FormData(); // console.log(this.adForm.value)\n\n      formData.append('title', this.adForm.controls['title'].value);\n      formData.append('desc', this.adForm.controls['desc'].value);\n      formData.append('phone', this.adForm.controls['phone'].value);\n      formData.append('salary', this.adForm.controls['salary'].value);\n      formData.append('section_id', this.adForm.controls['section_id'].value);\n      formData.append('address', this.adForm.controls['address'].value);\n      formData.append('con_type', this.adForm.controls['con_type'].value);\n      formData.append('device_token', this.deviceToken); //  formData.forEach(ite => console.log(ite))\n      // console.log(formData)\n\n      if (this.id != '0') {\n        //edit ad\n        if (this.currentImage.length == 0 && this.new_Image.length == 0) {\n          this.toasterService.showFail('يجب رفع صورة');\n          return;\n        }\n\n        formData.forEach(ite => console.log(ite));\n        formData.append('id', this.id);\n        formData.append('oldImages', JSON.stringify(this.currentImage));\n        formData.append('NewImages', JSON.stringify(this.new_Image));\n        this.toasterService.loading('جارى التعديل...');\n        this.market.edit_ad(formData).subscribe(res => {\n          var _a;\n\n          this.toasterService.stopLoading();\n          this.toasterService.showSuccess(res.message + '');\n          this.router.navigate([`/market/${this.url[2]}/ad_details/${(_a = res.data) === null || _a === void 0 ? void 0 : _a.ad_detials.id}`]);\n        }, err => {\n          this.toasterService.stopLoading();\n          this.toasterService.showFail(err.error.error);\n        });\n      } else {\n        //createad\n        if (this.AllFiles.length <= 0) {\n          this.toasterService.showFail('يجب رفع صورة');\n          return;\n        }\n\n        formData.append('images', JSON.stringify(this.AllFiles));\n        this.toasterService.loading('جارى التحميل...');\n        this.market.add_ad(formData).subscribe(res => {\n          var _a; //  console.log(res)\n          // console.log(`/market/${this.url[2]}/ad_details/${res.data?.ad_detials.id}`)\n\n\n          this.toasterService.stopLoading();\n          this.toasterService.showSuccess(res.message + '');\n          this.router.navigate([`/market/${this.url[2]}/ad_details/${(_a = res.data) === null || _a === void 0 ? void 0 : _a.ad_detials.id}`]);\n        }, err => {\n          this.toasterService.stopLoading();\n          this.toasterService.showFail(err.error.error); // console.log(err)\n        });\n      }\n    }\n\n    AdForm(data, secId) {\n      if (secId > 0) {\n        this.adForm = this.fb.group({\n          // if the purpose is to add an ad the value of control will be '' if  it is  edit get values from URL\n          title: [data.id ? data.title : '', [Validators.required]],\n          desc: [data.id ? data.desc : '', [Validators.required]],\n          phone: [data.id ? data.phone : '', [Validators.required]],\n          salary: [data.id ? data.salary : '', [Validators.required]],\n          address: [data.id ? data.address : '', [Validators.required]],\n          con_type: [data.id ? data.con_type : 'mobile', [Validators.required]],\n          section_id: [secId, [Validators.required]]\n        });\n      }\n    }\n\n    changeType(e) {\n      this.adForm.controls['con_type'].setValue(e.target.value);\n    }\n\n    deleteImages() {\n      this.AllFiles = [];\n      this.currentImage = [];\n      this.new_Image = [];\n    }\n\n  }\n\n  AddAdComponent.ɵfac = function AddAdComponent_Factory(t) {\n    return new (t || AddAdComponent)(i0.ɵɵdirectiveInject(i1.MarketService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.ToasterService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i4.FormBuilder), i0.ɵɵdirectiveInject(i5.Title), i0.ɵɵdirectiveInject(i6.HttpClient), i0.ɵɵdirectiveInject(i7.AuthService));\n  };\n\n  AddAdComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddAdComponent,\n    selectors: [[\"app-add-ad\"]],\n    decls: 39,\n    vars: 6,\n    consts: [[1, \"add__add__container\", \"d-flex\", \"justify-content-between\"], [1, \"ads__holder\"], [1, \"main-title\"], [1, \"form-box\", 3, \"formGroup\"], [\"formControlName\", \"title\", \"placeholder\", \"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0625\\u0639\\u0644\\u0627\\u0646\", \"type\", \"text\", 1, \"ad-name\", \"inputs\"], [\"formControlName\", \"salary\", \"placeholder\", \"\\u0627\\u0644\\u0633\\u0639\\u0631\", \"type\", \"number\", 1, \"ad-price\", \"inputs\"], [\"formControlName\", \"address\", \"placeholder\", \"\\u0627\\u0644\\u0639\\u0646\\u0648\\u0627\\u0646\", \"type\", \"text\", 1, \"ad-address\", \"inputs\"], [\"formControlName\", \"phone\", \"placeholder\", \"\\u0627\\u0644\\u0645\\u0648\\u0628\\u0627\\u064A\\u0644\", \"type\", \"number\", 1, \"ad-number\", \"inputs\"], [\"formControlName\", \"desc\", \"name\", \"description\", \"placeholder\", \"\\u062A\\u0641\\u0627\\u0635\\u064A\\u0644 \\u0627\\u0644\\u0627\\u0639\\u0644\\u0627\\u0646\", \"rows\", \"5\", 1, \"ad-address\"], [\"class\", \"d-flex justify-content-center align-items-center flex-column\", 4, \"ngFor\", \"ngForOf\"], [1, \"w-100\", \"custom-file\", \"my-3\"], [\"class\", \" btn btn-danger m-3\", \"color\", \"warn\", \"mat-stroked-button\", \"\", \"type\", \"button\", 3, \"click\", 4, \"ngIf\"], [\"multiple\", \"\", \"accept\", \"image/png,image/jpeg,image/jpg,image/gif*\", \"aria-describedby\", \"Upload Photo Or Video\", \"type\", \"file\", 1, \"d-none\", 2, \"display\", \"none\", 3, \"change\"], [\"fileImage\", \"\"], [\"color\", \"primary\", \"mat-stroked-button\", \"\", \"type\", \"button\", 1, \"w-100\", \"add-photo\", \"d-flex\", \"flex-column\", \"align-items-center\", \"p-3\", 3, \"click\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"62\", \"height\", \"62\", \"viewBox\", \"0 0 24 24\", 2, \"color\", \"#737373\"], [\"fill\", \"currentColor\", \"d\", \"M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2m-4.7 6H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v8.3c-.6-.2-1.3-.3-2-.3c-1.1 0-2.2.3-3.1.9L14.5 12L11 16.5l-2.5-3L5 18h8.1c-.1.3-.1.7-.1 1c0 .7.1 1.4.3 2Z\"], [1, \"input-images\"], [1, \"contact-me\"], [1, \"radio-box\"], [1, \"box\"], [\"formArrayName\", \"con_type\", \"id\", \"mobile\", \"name\", \"mobile\", \"type\", \"radio\", \"value\", \"mobile\", 3, \"checked\", \"change\"], [\"for\", \"mobile\"], [\"formArrayName\", \"con_type\", \"id\", \"msgs\", \"name\", \"mobile\", \"type\", \"radio\", \"value\", \"msgs\", 3, \"change\"], [\"for\", \"msgs\"], [\"formArrayName\", \"con_type\", \"id\", \"both\", \"name\", \"mobile\", \"type\", \"radio\", \"value\", \"both\", 3, \"change\"], [\"for\", \"both\"], [\"mat-raised-button\", \"\", \"type\", \"submit\", 1, \"submit\", 3, \"click\"], [1, \"d-md-block\", \"d-none\"], [\"src\", \"assets/images/apply.png\", \"alt\", \"\"], [1, \"d-flex\", \"justify-content-center\", \"align-items-center\", \"flex-column\"], [\"alt\", \"\", 2, \"width\", \"150px\", \"height\", \"150px\", \"margin\", \"2px\", 3, \"src\"], [\"color\", \"warn\", \"mat-stroked-button\", \"\", \"type\", \"button\", 1, \"btn\", \"btn-danger\", \"m-3\", 3, \"click\"]],\n    template: function AddAdComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r6 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"article\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h2\", 2);\n        i0.ɵɵtext(3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"form\", 3);\n        i0.ɵɵelement(5, \"input\", 4);\n        i0.ɵɵelement(6, \"input\", 5);\n        i0.ɵɵelement(7, \"input\", 6);\n        i0.ɵɵelement(8, \"input\", 7);\n        i0.ɵɵelement(9, \"textarea\", 8);\n        i0.ɵɵtemplate(10, AddAdComponent_div_10_Template, 2, 1, \"div\", 9);\n        i0.ɵɵelementStart(11, \"div\", 10);\n        i0.ɵɵtemplate(12, AddAdComponent_button_12_Template, 2, 0, \"button\", 11);\n        i0.ɵɵelementStart(13, \"input\", 12, 13);\n        i0.ɵɵlistener(\"change\", function AddAdComponent_Template_input_change_13_listener($event) {\n          return ctx.handleFileInput($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"button\", 14);\n        i0.ɵɵlistener(\"click\", function AddAdComponent_Template_button_click_15_listener() {\n          i0.ɵɵrestoreView(_r6);\n\n          const _r2 = i0.ɵɵreference(14);\n\n          return _r2.click();\n        });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(16, \"svg\", 15);\n        i0.ɵɵelement(17, \"path\", 16);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(18, \" \\u0627\\u0636\\u0641 \\u0635\\u0648\\u0631 \\u0627\\u0644\\u0627\\u0639\\u0644\\u0627\\u0646 \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelement(19, \"div\", 17);\n        i0.ɵɵelementStart(20, \"span\", 18);\n        i0.ɵɵtext(21, \"\\u062A\\u0648\\u0627\\u0635\\u0644 \\u0645\\u0639\\u064A \\u0639\\u0646 \\u0637\\u0631\\u064A\\u0642\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"section\", 19);\n        i0.ɵɵelementStart(23, \"div\", 20);\n        i0.ɵɵelementStart(24, \"input\", 21);\n        i0.ɵɵlistener(\"change\", function AddAdComponent_Template_input_change_24_listener($event) {\n          return ctx.changeType($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"label\", 22);\n        i0.ɵɵtext(26, \"\\u0627\\u0644\\u0645\\u0648\\u0628\\u0627\\u064A\\u0644\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"div\", 20);\n        i0.ɵɵelementStart(28, \"input\", 23);\n        i0.ɵɵlistener(\"change\", function AddAdComponent_Template_input_change_28_listener($event) {\n          return ctx.changeType($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"label\", 24);\n        i0.ɵɵtext(30, \"\\u0627\\u0644\\u0631\\u0633\\u0627\\u0626\\u0644\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(31, \"div\", 20);\n        i0.ɵɵelementStart(32, \"input\", 25);\n        i0.ɵɵlistener(\"change\", function AddAdComponent_Template_input_change_32_listener($event) {\n          return ctx.changeType($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"label\", 26);\n        i0.ɵɵtext(34, \"\\u0643\\u0644\\u0627\\u0647\\u0645\\u0627\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"button\", 27);\n        i0.ɵɵlistener(\"click\", function AddAdComponent_Template_button_click_35_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵtext(36);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(37, \"div\", 28);\n        i0.ɵɵelement(38, \"img\", 29);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", ctx.pageName, \"\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.adForm);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.AllFiles);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.AllFiles.length > 0);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"checked\", true);\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \", ctx.pageName, \" \");\n      }\n    },\n    directives: [i4.ɵNgNoValidate, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.DefaultValueAccessor, i4.NgControlStatus, i4.FormControlName, i4.NumberValueAccessor, i8.NgForOf, i8.NgIf, i4.FormArrayName],\n    styles: [\"@font-face{font-family:bein;src:url(beinNormal.9cce43bba1950a38.ttf)}.list__item.selected[_ngcontent-%COMP%]{color:#0c6a22;background-color:#fb3}.main-title[_ngcontent-%COMP%]{background:#E4E1E1;border-radius:20px;width:100%}.add-photo[_ngcontent-%COMP%]{box-shadow:inset 0 3px 6px #0000000f,0 3px 6px #0000004f;border:none;border-radius:16px;background:white;color:var(--green)}\"]\n  });\n  return AddAdComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}