{"ast":null,"code":"import { Magazine_Search_Form } from '@app/@core/interfaces/magazine/magazine';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../../../@core/services/modules/magazine/magazine.service\";\nimport * as i3 from \"@app/@core/services/Banners-logos.service\";\nimport * as i4 from \"@angular/platform-browser\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"../../../../@shared/components/app/banner-logos/banner-logos.component\";\nimport * as i7 from \"../../../../@shared/components/app/horizontal-search/horizontal-search.component\";\nimport * as i8 from \"../../../../@shared/components/app/card/card.component\";\nimport * as i9 from \"ngx-pagination\";\nimport * as i10 from \"../../../../@shared/components/loader/loader.component\";\n\nfunction MagazineComponent_app_loader_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\n\nfunction MagazineComponent_span_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", 10 * (ctx_r1.page.last_page - 1) + ctx_r1.comLength, \" \\u0645\\u062C\\u0644\\u0629\");\n  }\n}\n\nfunction MagazineComponent_span_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.magazines == null ? null : ctx_r2.magazines.length, \" \\u0645\\u062C\\u0644\\u0629\");\n  }\n}\n\nfunction MagazineComponent_li_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"li\");\n  }\n}\n\nconst _c0 = function () {\n  return [];\n};\n\nconst _c1 = function (a1) {\n  return {\n    itemsPerPage: 1,\n    currentPage: a1\n  };\n};\n\nexport let MagazineComponent = /*#__PURE__*/(() => {\n  class MagazineComponent {\n    constructor(activatedRoute, magazine, BannerLogoService, router, titleService, location, route) {\n      this.activatedRoute = activatedRoute;\n      this.magazine = magazine;\n      this.BannerLogoService = BannerLogoService;\n      this.router = router;\n      this.titleService = titleService;\n      this.location = location;\n      this.route = route;\n      this.loading = false;\n      this.filterData = {\n        type: \"0\",\n        sort: \"2\",\n        search: \"\",\n        countries: '',\n        cities: '',\n        page: '1'\n      };\n      this.page = {\n        last_page: 0,\n        current_page: 0\n      };\n      this.typeAr = '';\n      this.comLength = 0;\n\n      this.onBackButtonEvent = event => {\n        const page = this.getPageNumberFromUrl();\n        const sort = this.getSortFromUrl();\n\n        if (page !== this.page.current_page || sort !== +this.filterData[\"sort\"]) {\n          this.page.current_page = page;\n          this.filterData[\"page\"] = page + '';\n          this.filterData[\"sort\"] = sort + '';\n          this.magazine.magazines(this.filterData['sector'], this.filterData['sort'], this.filterData['countries'], this.filterData['cities'], this.filterData['search'], this.filterData[\"page\"]).subscribe(res => {\n            var _a;\n\n            this.magazines = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data;\n          });\n        }\n\n        window.scroll(0, 0);\n      };\n    }\n\n    ngOnInit() {\n      this.titleService.setTitle('الدلائل و المجلات');\n      this.h_search_form = Magazine_Search_Form; //set initial data to horizontal component \n\n      this.route.queryParamMap.subscribe(params => {\n        this.filterData['page'] = params.get('page') || '1';\n        this.filterData['sort'] = params.get('sort') || '0';\n      });\n      this.route.params.subscribe(prm => {\n        this.filterData['sector'] = prm['type'];\n      });\n      this.activatedRoute.data.subscribe(data => {\n        var _a, _b, _c;\n\n        this.page.current_page = data['resolve'].data.current_page;\n        this.page.last_page = data['resolve'].data.last_page;\n        this.magazines = (_a = data['resolve'].data) === null || _a === void 0 ? void 0 : _a.data;\n        this.BannerLogoService.setBanner((_b = data['resolve'].data) === null || _b === void 0 ? void 0 : _b.banners);\n        this.BannerLogoService.setLogo((_c = data['resolve'].data) === null || _c === void 0 ? void 0 : _c.logos);\n        this.loading = false;\n        this.magazine.filter_list(this.filterData['sector'], 0).subscribe(res => {\n          var _a, _b, _c, _d; // override data to match the data format of horizontal components\n\n\n          this.h_search_form.controls.find(i => i.role === \"sector\").option = (_a = res.data) === null || _a === void 0 ? void 0 : _a.sectors;\n          this.h_search_form.controls.find(i => i.role === \"sort\").option = (_b = res.data) === null || _b === void 0 ? void 0 : _b.sort;\n          this.h_search_form.controls.find(i => i.role === \"countries\").option = (_c = res.data) === null || _c === void 0 ? void 0 : _c.countries;\n          this.h_search_form.controls.find(i => i.role === \"cities\").option = (_d = res.data) === null || _d === void 0 ? void 0 : _d.cities;\n          this.setSelectedSort(this.filterData['sort']);\n          this.typeAr = this.h_search_form.controls.find(i => i.role === \"sector\").option.find(i => i.selected == 1).name;\n          this.filterData['sector'] = this.h_search_form.controls.find(i => i.role === \"sector\").option.find(i => i.selected == 1).id;\n          this.location.go(`/magazine/${this.filterData['sector']}?sort=${this.filterData['sort']}&page=${this.filterData['page']}`);\n        }); // console.log(data['resolve'].data);\n      });\n\n      if (this.page.last_page > 1) {\n        this.magazine.magazines(this.filterData['sector'], '2', '', '', '', this.page.last_page + '').subscribe(res => {\n          var _a;\n\n          this.comLength = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data.length;\n        });\n      }\n\n      window.addEventListener('popstate', this.onBackButtonEvent);\n    }\n\n    filter(value) {\n      this.filterData['sort'] = '2';\n      this.filterData['cities'] = '';\n      this.filterData['search'] = '';\n      let sort = '2';\n      this.filterData['page'] = '1';\n\n      switch (value.type) {\n        case \"sector\":\n          this.filterData['sector'] = value.id;\n          this.typeAr = value.title;\n          this.magazine.filter_list(this.filterData['sector'], 0).subscribe(res => {\n            var _a, _b, _c; // override data to match the data format of horizontal components\n\n\n            this.h_search_form.controls.find(i => i.role === \"sector\").option = (_a = res.data) === null || _a === void 0 ? void 0 : _a.sectors;\n            this.h_search_form.controls.find(i => i.role === \"countries\").option = (_b = res.data) === null || _b === void 0 ? void 0 : _b.countries;\n            this.h_search_form.controls.find(i => i.role === \"cities\").option = (_c = res.data) === null || _c === void 0 ? void 0 : _c.cities;\n          });\n          this.setSelectedSort(this.filterData['sort']); // this.location.go(`/magazine/${this.filterData['sector']}?sort=${this.filterData['sort']}&page=${this.filterData['page']}`);\n\n          break;\n\n        case \"sort\":\n          this.filterData['sort'] = value.id;\n          this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === value.id).selected = 1;\n          this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id !== value.id).selected = 0;\n          sort = this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === value.id).value;\n\n          if (value.id == '1') {\n            sort = '0';\n          } else if (value.id == '2') {\n            sort = '2';\n          }\n\n          this.filterData[\"sort\"] = sort;\n          break;\n\n        case \"countries\":\n          if (value.id == 0) {\n            this.filterData['countries'] = '0';\n          } else {\n            this.filterData['countries'] = value.id;\n            this.filterData['cities'] = '0';\n          } // this.filterData['countries'] = value.id \n\n\n          this.magazine.filter_list(this.filterData['sector'], +this.filterData['countries']).subscribe(res => {\n            var _a, _b, _c; // override data to match the data format of horizontal components\n\n\n            this.h_search_form.controls.find(i => i.role === \"sector\").option = (_a = res.data) === null || _a === void 0 ? void 0 : _a.sectors;\n            this.h_search_form.controls.find(i => i.role === \"countries\").option = (_b = res.data) === null || _b === void 0 ? void 0 : _b.countries;\n            this.h_search_form.controls.find(i => i.role === \"cities\").option = (_c = res.data) === null || _c === void 0 ? void 0 : _c.cities;\n          }); // console.log(this.filterData['countries']);\n\n          break;\n\n        case \"cities\":\n          if (value.id == 0) {\n            this.filterData['cities'] = '';\n          } else {\n            this.filterData['cities'] = value.id;\n          } // this.filterData['cities'] = value.id \n          //  console.log(this.filterData['countries']);\n          //  this.filterData['countries']=''\n\n\n          break;\n\n        case \"search\":\n          this.filterData['search'] = value.name;\n          break;\n\n        default:\n          break;\n      }\n\n      this.magazine.magazines(this.filterData['sector'], this.filterData['sort'], this.filterData['countries'], this.filterData['cities'], this.filterData['search'], this.filterData[\"page\"]).subscribe(res => {\n        var _a, _b, _c;\n\n        this.page.current_page = (_a = res.data) === null || _a === void 0 ? void 0 : _a.current_page;\n        this.page.last_page = (_b = res.data) === null || _b === void 0 ? void 0 : _b.last_page;\n        this.magazines = (_c = res.data) === null || _c === void 0 ? void 0 : _c.data; // console.log(this.page.last_page);\n\n        if (this.page.last_page > 1) {\n          this.magazine.magazines(this.filterData['sector'], '0', '', '', '', this.page.last_page + '').subscribe(res => {\n            var _a;\n\n            this.comLength = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data.length; // console.log(this.comLength);\n          });\n        }\n      });\n      this.location.go(`/magazine/${this.filterData['sector']}?sort=${this.filterData['sort']}&page=${this.filterData['page']}`);\n    }\n\n    navigate(id) {\n      this.router.navigate([`magazine/${this.filterData['sector']}/details/${id}`]);\n    }\n\n    next_page(page) {\n      this.filterData[\"page\"] = page + '';\n      this.magazine.magazines(this.filterData['sector'], this.filterData['sort'], this.filterData['countries'], this.filterData['cities'], this.filterData['search'], this.filterData[\"page\"]).subscribe(res => {\n        var _a;\n\n        this.magazines = (_a = res.data) === null || _a === void 0 ? void 0 : _a.data;\n      });\n      window.scroll(0, 0);\n      this.location.go(`/magazine/${this.filterData['sector']}?sort=${this.filterData['sort']}&page=${this.filterData['page']}`);\n    }\n\n    getPageNumberFromUrl() {\n      const page = this.location.path().match(/page=(\\d+)/);\n      return page ? +page[1] : 1;\n    }\n\n    getSortFromUrl() {\n      const sort = this.location.path().match(/sort=(\\d+)/);\n      return sort ? +sort[1] : 1;\n    }\n\n    setSelectedSort(id) {\n      let temp = 1;\n\n      if (id == '0') {\n        temp = 1;\n      } else if (id == '2') {\n        temp = 2;\n      }\n\n      for (let option of this.h_search_form.controls.find(i => i.role === \"sort\").option) {\n        option.selected = 0;\n      }\n\n      this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id === temp).selected = 1;\n      this.h_search_form.controls.find(i => i.role === \"sort\").option.find(i => i.id !== temp).selected = 0;\n    }\n\n  }\n\n  MagazineComponent.ɵfac = function MagazineComponent_Factory(t) {\n    return new (t || MagazineComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.MagazineService), i0.ɵɵdirectiveInject(i3.BannersLogoservice), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i4.Title), i0.ɵɵdirectiveInject(i5.Location), i0.ɵɵdirectiveInject(i1.ActivatedRoute));\n  };\n\n  MagazineComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MagazineComponent,\n    selectors: [[\"app-magazine\"]],\n    decls: 21,\n    vars: 22,\n    consts: [[4, \"ngIf\"], [1, \"main__content__body\"], [1, \"container\"], [1, \"mt-3\", \"mt-lg-0\"], [3, \"loading\", \"type\"], [3, \"data\", \"newItemEvent\"], [1, \"container\", \"global__container\"], [1, \"title\"], [\"class\", \"sections-number\", 4, \"ngIf\"], [3, \"data\", \"subcard\", \"loading\", \"flag\", \"navigation\"], [1, \"row\", \"pagination__container\"], [1, \"col-12\"], [1, \"pagination\"], [4, \"ngFor\", \"ngForOf\"], [\"previousLabel\", \"\", \"nextLabel\", \"\", 3, \"maxSize\", \"click\", \"pageChange\"], [1, \"sections-number\"]],\n    template: function MagazineComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, MagazineComponent_app_loader_0_Template, 1, 0, \"app-loader\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"h1\", 3);\n        i0.ɵɵtext(4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(5, \"app-banners-logo\", 4);\n        i0.ɵɵelement(6, \"app-banners-logo\", 4);\n        i0.ɵɵelementStart(7, \"app-horizontal-search\", 5);\n        i0.ɵɵlistener(\"newItemEvent\", function MagazineComponent_Template_app_horizontal_search_newItemEvent_7_listener($event) {\n          return ctx.filter($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"article\", 6);\n        i0.ɵɵelementStart(9, \"h2\", 7);\n        i0.ɵɵtext(10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(11, MagazineComponent_span_11_Template, 2, 1, \"span\", 8);\n        i0.ɵɵtemplate(12, MagazineComponent_span_12_Template, 2, 1, \"span\", 8);\n        i0.ɵɵelementStart(13, \"app-card\", 9);\n        i0.ɵɵlistener(\"navigation\", function MagazineComponent_Template_app_card_navigation_13_listener($event) {\n          return ctx.navigate($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"div\", 10);\n        i0.ɵɵelementStart(15, \"div\", 11);\n        i0.ɵɵelementStart(16, \"div\", 12);\n        i0.ɵɵelementStart(17, \"ul\");\n        i0.ɵɵtemplate(18, MagazineComponent_li_18_Template, 1, 0, \"li\", 13);\n        i0.ɵɵpipe(19, \"paginate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"pagination-controls\", 14);\n        i0.ɵɵlistener(\"click\", function MagazineComponent_Template_pagination_controls_click_20_listener() {\n          return ctx.next_page(ctx.page.current_page);\n        })(\"pageChange\", function MagazineComponent_Template_pagination_controls_pageChange_20_listener($event) {\n          return ctx.page.current_page = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.h_search_form.title);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"loading\", ctx.loading)(\"type\", \"banner\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"loading\", ctx.loading)(\"type\", \"logo\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"data\", ctx.h_search_form);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.typeAr);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.page.last_page > 1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.page.last_page == 1);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"data\", ctx.magazines)(\"subcard\", true)(\"loading\", ctx.loading)(\"flag\", false);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind2(19, 16, i0.ɵɵpureFunction0(19, _c0).constructor(ctx.page.last_page), i0.ɵɵpureFunction1(20, _c1, ctx.page.current_page)));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"maxSize\", 7);\n      }\n    },\n    directives: [i5.NgIf, i6.BannerLogosComponent, i7.HorizontalSearchComponent, i8.CardComponent, i5.NgForOf, i9.PaginationControlsComponent, i10.LoaderComponent],\n    pipes: [i9.PaginatePipe],\n    styles: [\"\"]\n  });\n  return MagazineComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}